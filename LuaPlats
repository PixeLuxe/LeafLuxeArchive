-- LOVE ENGINE
function love.load()
	love.math.setRandomSeed(os.time())
  require("Intro/intro")
  require("map")
  require("player")
  introInitialise("Games")
  mapInitialise()
  playerInitialise()
  operatingSystem = love.system.getOS()

  gameColour = {}
  gameColour.foreground = {203, 100, 34}
  gameColour.background = {203, 100, 17}
  fr, fg, fb, fa = HSL(gameColour.foreground[1]/360, gameColour.foreground[2]/100, gameColour.foreground[3]/100, 1)
  br, bg, bb, ba = HSL(gameColour.background[1]/360, gameColour.background[2]/100, gameColour.background[3]/100, 1)
  love.graphics.setBackgroundColour(br, bg, bb)

  screen = {}
  screen.x = 0
  screen.y = 6000
  screen.font = love.graphics.newFont("Public_Sans/static/PublicSans-Black.ttf", 20)
  screen.megaFont = love.graphics.newFont("Public_Sans/static/PublicSans-Black.ttf", 40)
  screen.shakeX = 0
  screen.shakeY = 0
  screen.shake = 0
  screen.shakeYV = 0
  screen.state = 1
  screen.overlayAlpha = 0
  screen.msgTime = love.timer.getTime()
  screen.alertAlpha = 1
  if operatingSystem == "OS X" then 
    screen.message = "WASD/Arrow keys to move\n\n[R] to reset player\n[ESC] to quit\n[CTRL+CMD+F] to go fullscreen\n\n[?] to close"
  elseif operatingSystem == "Windows" then 
    screen.message = "WASD/Arrow keys to move\n\n[R] to reset player\n[ESC] to quit\n[F11] to go fullscreen\n\n[?] to close"
  else
    screen.message = "WASD/Arrow keys to move\n\n[R] to reset player\n[ESC] to quit\n\n[?] to close"
  end
end

function love.update(dt)
  introUpdate(dt)

  screen.shakeX = love.math.random(-screen.shake, screen.shake)
  screen.shakeY = love.math.random(-screen.shake, screen.shake)
  screen.shake = screen.shake + (0-screen.shake)*0.3
	screen.x = screen.x + (-player.x+love.graphics.getWidth()/2-screen.x)*0.3
 
  if screen.x > 0 then 
  	screen.x = 0--screen.x/5
  end
  if screen.x < -7900 then 
    screen.x = -7900--screen.x/5
  end

  if intro.timer >  1 then
    screen.y = screen.y + (love.graphics.getHeight()/2-300-screen.y)*0.1
  end
  if intro.timer >  1.5 then
    playerUpdate()
    --particleUpdate()
  end

  map.alpha = 1
  if love.keyboard.isDown("p") then
  	if love.keyboard.isDown("q") then 
  		map.alpha = 0.5
  	end
  	if love.keyboard.isDown("l") then 
  		player.checkpoint = 1
  		playerDie()
      player.deaths = player.deaths - 1 
  		screen.state = 1
      player.coins = 0
      for i=1, #map.coins do -- loops through coins and gives them an "alive" tag
        map.coins[i][4] = "alive"
        player.coinCache[i] = "alive"
      end
      intro.timer = 1.5
  	end
  end

  if player.x > 52 then 
  	screen.alertAlpha = screen.alertAlpha + (0-screen.alertAlpha)*0.2
  end

  if player.checkpoint == 5 then 
    screen.state = 5
  end

  gameColour.foreground[1] = gameColour.foreground[1] + (map.checkpoints[player.checkpoint][3][1] - gameColour.foreground[1])*0.1
  gameColour.foreground[2] = gameColour.foreground[2] + (map.checkpoints[player.checkpoint][3][2] - gameColour.foreground[2])*0.1
  gameColour.foreground[3] = gameColour.foreground[3] + (map.checkpoints[player.checkpoint][3][3] - gameColour.foreground[3])*0.1
  gameColour.background[1] = gameColour.background[1] + (map.checkpoints[player.checkpoint][4][1] - gameColour.background[1])*0.1
  gameColour.background[2] = gameColour.background[2] + (map.checkpoints[player.checkpoint][4][2] - gameColour.background[2])*0.1
  gameColour.background[3] = gameColour.background[3] + (map.checkpoints[player.checkpoint][4][3] - gameColour.background[3])*0.1

  fr, fg, fb, fa = HSL(gameColour.foreground[1]/360, gameColour.foreground[2]/100, gameColour.foreground[3]/100, 1)
  br, bg, bb, ba = HSL(gameColour.background[1]/360, gameColour.background[2]/100, gameColour.background[3]/100, 1)
  love.graphics.setBackgroundColour(br, bg, bb)

  if screen.state == 1 then 
  	screen.overlayAlpha = screen.overlayAlpha + (0-screen.overlayAlpha)*0.2
  elseif screen.state == 3 then
  	screen.overlayAlpha = screen.overlayAlpha + (0.5-screen.overlayAlpha)*0.2
  else
  	screen.overlayAlpha = screen.overlayAlpha + (0.5-screen.overlayAlpha)*0.2
  end
  if love.keyboard.isDown("escape") then
    if love.window.isMaximized() or love.window.getFullscreen then
    	screen.state = 0
    end
  end
  if screen.state == 0 and screen.overlayAlpha > 0.499 then 
  	love.event.quit()
  end
  -- if love.keyboard.isDown("f") and love.keyboard.isDown("lgui") and love.keyboard.isDown("lctrl") and operatingSystem == "OS X" then
  --   	love.window.setFullscreen(true)
  -- end
  -- if love.keyboard.isDown("f11") and operatingSystem == "Windows" then
  --     love.window.setFullscreen(true)
  -- end
  if love.keyboard.isDown("/") and screen.msgTime - love.timer.getTime() < -0.3 then
    	if screen.state == 1 then
    		screen.state = 3
    	elseif screen.state == 3 then 
    		screen.state = 1
    	end
    	screen.msgTime = love.timer.getTime()
  end
end

  
  introDraw()
end
